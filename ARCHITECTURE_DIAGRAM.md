# üèóÔ∏è Diagrama de Clean Architecture - Servicio RIMAC

## Estructura de Capas

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     FRAMEWORKS & DRIVERS                               ‚îÇ
‚îÇ                  (AWS Lambda, HTTP, SQS)                               ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ   handler_new.mjs  (HTTP Entry Point)    workers_new.mjs (SQS Entry)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                                 ‚îÇ
         ‚ñº                                                 ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   INTERFACE ADAPTERS                                     ‚îÇ
‚îÇ          (Controllers, Handlers, Presenters)                             ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ    ‚îÇ HTTPController  ‚îÇ                    ‚îÇ  SQSHandler      ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ                 ‚îÇ                    ‚îÇ                  ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ register()    ‚îÇ                    ‚îÇ ‚Ä¢ handleEvent()  ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ consult()     ‚îÇ                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                                  ‚îÇ
‚îÇ             ‚îÇ                                           ‚îÇ                ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
              ‚îÇ                                           ‚îÇ
              ‚ñº                                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    APPLICATION LAYER                                     ‚îÇ
‚îÇ             (USE CASES / BUSINESS LOGIC)                                ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê           ‚îÇ
‚îÇ    ‚îÇ  RegisterAppointment     ‚îÇ  ‚îÇ  ConsultAppointment      ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ  UseCase                 ‚îÇ  ‚îÇ  UseCase                 ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ                          ‚îÇ  ‚îÇ                          ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ 1. Validate DTO          ‚îÇ  ‚îÇ 1. Validate userId       ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ 2. Create Entity         ‚îÇ  ‚îÇ 2. Query Repository      ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ 3. Save Repository       ‚îÇ  ‚îÇ 3. Return Response       ‚îÇ           ‚îÇ
‚îÇ    ‚îÇ 4. Publish SNS           ‚îÇ  ‚îÇ                          ‚îÇ           ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò           ‚îÇ
‚îÇ                   ‚îÇ                           ‚îÇ                         ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê          ‚îÇ
‚îÇ    ‚îÇ         ProcessAppointment UseCase                      ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ                                                         ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ  1. Validate appointment data                          ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ  2. Save to regional database (Postgres)               ‚îÇ          ‚îÇ
‚îÇ    ‚îÇ  3. Return confirmation                                ‚îÇ          ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò          ‚îÇ
‚îÇ                     ‚îÇ                                                   ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                          ‚îÇ
‚îÇ    ‚îÇ      DTOs (Data Transfer Objects)      ‚îÇ                          ‚îÇ
‚îÇ    ‚îÇ  ‚Ä¢ AppointmentDTO                      ‚îÇ                          ‚îÇ
‚îÇ    ‚îÇ  ‚Ä¢ Validation logic                    ‚îÇ                          ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                        ‚îÇ
         ‚ñº                                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                      DOMAIN LAYER                                        ‚îÇ
‚îÇ                  (BUSINESS RULES)                                        ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê       ‚îÇ
‚îÇ    ‚îÇ  ENTITIES        ‚îÇ         ‚îÇ  REPOSITORY INTERFACES         ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ                  ‚îÇ         ‚îÇ                               ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ Appointment      ‚îÇ         ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ userId         ‚îÇ         ‚îÇ ‚îÇIAppointmentRepository   ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ nombre         ‚îÇ         ‚îÇ ‚îÇ ‚Ä¢ save()                ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ countryISO     ‚îÇ         ‚îÇ ‚îÇ ‚Ä¢ findAll()             ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ status         ‚îÇ         ‚îÇ ‚îÇ ‚Ä¢ findById()            ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ timestamp      ‚îÇ         ‚îÇ ‚îÇ ‚Ä¢ update()              ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ                  ‚îÇ         ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ Methods:         ‚îÇ         ‚îÇ                               ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ isValid()      ‚îÇ         ‚îÇ ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îÇ       ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ toPlainObject()‚îÇ         ‚îÇ ‚îÇIPublishRepository       ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ ‚îÇ ‚Ä¢ publish()             ‚îÇ  ‚îÇ       ‚îÇ
‚îÇ                                 ‚îÇ ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îÇ       ‚îÇ
‚îÇ    (NO DEPENDENCIES)            ‚îÇ                               ‚îÇ       ‚îÇ
‚îÇ    (PURE BUSINESS LOGIC)         ‚îÇ  (PURE ABSTRACTIONS)         ‚îÇ       ‚îÇ
‚îÇ                                 ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                        ‚îÇ
         ‚ñº                                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                   INFRASTRUCTURE LAYER                                   ‚îÇ
‚îÇ           (IMPLEMENTATION DETAILS)                                       ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê               ‚îÇ
‚îÇ    ‚îÇ  DynamoDBRepository     ‚îÇ  ‚îÇ  PostgresRepository  ‚îÇ               ‚îÇ
‚îÇ    ‚îÇ  (implements IAppointment)  ‚îÇ (implements IAppointment)           ‚îÇ
‚îÇ    ‚îÇ                         ‚îÇ  ‚îÇ                      ‚îÇ               ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ save()                ‚îÇ  ‚îÇ ‚Ä¢ save()             ‚îÇ               ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ findAll()             ‚îÇ  ‚îÇ ‚Ä¢ findAll()          ‚îÇ               ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ findById()            ‚îÇ  ‚îÇ ‚Ä¢ findById()         ‚îÇ               ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ update()              ‚îÇ  ‚îÇ ‚Ä¢ update()           ‚îÇ               ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò               ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                        ‚îÇ
‚îÇ    ‚îÇ    SNSPublisher          ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ  (implements IPublisher) ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ                          ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ publish()              ‚îÇ                                        ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                        ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê                                        ‚îÇ
‚îÇ    ‚îÇ   DatabaseConfig         ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ                          ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ createPostgresPool()   ‚îÇ                                        ‚îÇ
‚îÇ    ‚îÇ ‚Ä¢ getPostgresPool()      ‚îÇ                                        ‚îÇ
‚îÇ    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                                        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ                                        ‚îÇ
         ‚ñº                                        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                    EXTERNAL SERVICES                                     ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îÇ   AWS DynamoDB    AWS SNS      PostgreSQL Database     AWS SQS          ‚îÇ
‚îÇ                                                                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò


‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                 DEPENDENCY INJECTION CONTAINER                          ‚îÇ
‚îÇ                    (src/di/container.js)                                ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  Crea y gestiona todas las dependencias de forma centralizada          ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îÇ  ‚Ä¢ Singletons (una instancia por aplicaci√≥n)                          ‚îÇ
‚îÇ  ‚Ä¢ Inyecci√≥n autom√°tica de dependencias                               ‚îÇ
‚îÇ  ‚Ä¢ F√°cil de testear (moclear repositorios)                            ‚îÇ
‚îÇ                                                                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

## Flujos de Datos

### 1Ô∏è‚É£ Flujo POST /registrar

```
HTTP Request
    ‚îÇ
    ‚îú‚îÄ Path: POST /registrar
    ‚îú‚îÄ Body: { userId, nombre, countryISO, ... }
    ‚îÇ
    ‚ñº
handler_new.mjs
    ‚îÇ
    ‚îú‚îÄ createContainer()
    ‚îú‚îÄ get('httpController')
    ‚îÇ
    ‚ñº
HTTPController.registerAppointment()
    ‚îÇ
    ‚îú‚îÄ Parse body ‚Üí AppointmentDTO
    ‚îÇ
    ‚ñº
RegisterAppointmentUseCase.execute(dto, topicArn)
    ‚îÇ
    ‚îú‚îÄ Validate DTO
    ‚îú‚îÄ Create Appointment Entity
    ‚îú‚îÄ Call dynamoDbRepository.save()
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚ñº
    ‚îÇ   DynamoDBRepository.save()
    ‚îÇ   - AWS DynamoDB PutCommand
    ‚îÇ
    ‚îú‚îÄ Call snsPublisher.publish()
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚ñº
    ‚îÇ   SNSPublisher.publish()
    ‚îÇ   - AWS SNS PublishCommand
    ‚îÇ   - Attributes: { countryISO: 'pe'/'cl' }
    ‚îÇ
    ‚ñº
HTTP Response 200
{
  "message": "Cita registrada exitosamente",
  "data": { ... }
}
```

### 2Ô∏è‚É£ Flujo GET /consultar/{userId}

```
HTTP Request
    ‚îÇ
    ‚îú‚îÄ Path: GET /consultar/user123
    ‚îÇ
    ‚ñº
handler_new.mjs
    ‚îÇ
    ‚îú‚îÄ createContainer()
    ‚îú‚îÄ get('httpController')
    ‚îÇ
    ‚ñº
HTTPController.consultAppointment(event)
    ‚îÇ
    ‚îú‚îÄ Extract userId from pathParameters
    ‚îÇ
    ‚ñº
ConsultAppointmentUseCase.execute(userId)
    ‚îÇ
    ‚îú‚îÄ Validate userId
    ‚îú‚îÄ Call dynamoDbRepository.findAll(userId)
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚ñº
    ‚îÇ   DynamoDBRepository.findAll()
    ‚îÇ   - AWS DynamoDB QueryCommand
    ‚îÇ   - Filter: userId = :id
    ‚îÇ
    ‚ñº
HTTP Response 200
{
  "total": 2,
  "items": [ ... ]
}
```

### 3Ô∏è‚É£ Flujo SQS (Workers)

```
SNS Topic
    ‚îÇ
    ‚îú‚îÄ Message Attributes: { countryISO: "pe" }
    ‚îÇ
    ‚ñº
SQS Subscription Filter
    ‚îÇ
    ‚îú‚îÄ IF countryISO == "pe" ‚Üí ColaPE
    ‚îú‚îÄ IF countryISO == "cl" ‚Üí ColaCL
    ‚îÇ
    ‚ñº
CloudWatch Event Trigger
    ‚îÇ
    ‚îú‚îÄ workers_new.appointment_pe()
    ‚îú‚îÄ workers_new.appointment_cl()
    ‚îÇ
    ‚ñº
createContainer()
    ‚îÇ
    ‚îú‚îÄ get('sqsHandler')
    ‚îÇ
    ‚ñº
SQSHandler.handleSQSEvent(event)
    ‚îÇ
    ‚îú‚îÄ Loop Records
    ‚îÇ ‚îú‚îÄ Parse SNS Message from SQS Body
    ‚îÇ ‚îú‚îÄ Extract appointmentData
    ‚îÇ
    ‚ñº
ProcessAppointmentUseCase.execute(appointmentData)
    ‚îÇ
    ‚îú‚îÄ Validate data
    ‚îú‚îÄ Call postgresRepository.save()
    ‚îÇ   ‚îÇ
    ‚îÇ   ‚ñº
    ‚îÇ   PostgresRepository.save()
    ‚îÇ   - AWS Postgres INSERT query
    ‚îÇ   - INSERT INTO appointments (user_id, nombre, ...)
    ‚îÇ
    ‚ñº
Lambda Response 200
{
  "message": "Cita procesada exitosamente",
  "data": { ... }
}
```

## Principios Aplicados

### üéØ Dependency Inversion
```
Application Layer
    ‚Üì (depende)
Domain Layer (Interfaces)
    ‚Üë (implementa)
Infrastructure Layer
```

### üéØ Single Responsibility
- **Appointment**: Solo conoce sus propias propiedades
- **RegisterUseCase**: Solo orquesta el caso de uso
- **HTTPController**: Solo convierte HTTP ‚Üî Use Cases
- **DynamoDBRepository**: Solo interact√∫a con DynamoDB

### üéØ Open/Closed
```
RegisterUseCase no conoce si es DynamoDB o PostgreSQL
Porque depende de la interfaz IAppointmentRepository
Podemos cambiar implementaciones sin tocar el use case
```

### üéØ Liskov Substitution
```
class DynamoDBRepository extends IAppointmentRepository { }
class PostgresRepository extends IAppointmentRepository { }

// Ambas pueden ser usadas intercambiablemente
```

### üéØ Interface Segregation
```
IAppointmentRepository ‚Üí findAll, save, update
IPublishRepository ‚Üí publish

(No una mega-interfaz con todo)
```

## Testabilidad

```javascript
// Sin Clean Architecture (dif√≠cil de testear)
export const consultarDynamo = async (event) => {
    const docClient = new DynamoDBDocumentClient(...);  // ‚Üê Dependencia hardcodeada
    // ...
}

// Con Clean Architecture (f√°cil de testear)
export const consultarDynamo = async (event) => {
    const container = createContainer();
    const controller = container.get('httpController');  // ‚Üê Dependencia inyectada
    // ...
}

// En tests:
const mockRepository = new MockRepository();
const useCase = new RegisterAppointmentUseCase(mockRepository, mockPublisher);
// ‚úÖ Podemos testear sin DynamoDB real
```

## Mantenibilidad

| Aspecto | Sin Clean Arch | Con Clean Arch |
|---------||---|
| Cambiar BD | Modificar handler | Cambiar DynamoDBRepository |
| Agregar validaci√≥n | En handler | En AppointmentDTO o UseCase |
| Agregar logging | En varios lugares | En un lugar (Container) |
| Testear | Necesita AWS mock | F√°cil con mocks locales |
| Entender flujo | C√≥digo spaghetti | Claro y predecible |
